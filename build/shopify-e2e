#!/bin/bash
set -euo pipefail

if [[ -n "${DEBUG:+set}" ]]; then
  set -x
fi

_term() {
  echo "Test aborted via SIGTERM - was the CI instance preempted?"
  exit 1
}
trap _term SIGTERM

echo $PWD
ls -al

### build e2e image
go get github.com/onsi/ginkgo/ginkgo
ginkgo build ./test/e2e

cd test/e2e-image/
cp ../e2e/e2e.test .
cp ../e2e/wait-for-nginx.sh .
cp -r ../../deploy/cloud-generic .
cp -r ../../deploy/cluster-wide .

IMAGE=nginx-ingress-controller:e2e
docker build -t $(IMAGE) .
### build e2e image end

cd ../..
build/run-e2e-suite.sh
