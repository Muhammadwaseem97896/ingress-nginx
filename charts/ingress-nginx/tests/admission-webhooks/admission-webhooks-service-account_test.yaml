suite: AdmissionWebhooks > ServiceAccount
templates:
  - admission-webhooks/serviceaccount.yaml

tests:
  - it: should not create a ServiceAccount if `controller.admissionWebhooks.serviceAccount.create` is false
    set:
      controller.admissionWebhooks.serviceAccount.create: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should create a ServiceAccount if `controller.admissionWebhooks.serviceAccount.create` is true
    set:
      controller.admissionWebhooks.serviceAccount.create: true
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ServiceAccount
      - equal:
          path: metadata.name
          value: ingress-nginx-admission

  - it: should create a ServiceAccount with specified name if `controller.admissionWebhooks.serviceAccount.name` is set to non-empty value
    set:
      controller.admissionWebhooks.serviceAccount.name: ingress-nginx-admission-test-sa
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ServiceAccount
      - equal:
          path: metadata.name
          value: ingress-nginx-admission-test-sa

  - it: automountServiceAccountToken in ServiceAccount should be false if `controller.admissionWebhooks.serviceAccount.automountServiceAccountToken` is false
    set:
      controller.admissionWebhooks.serviceAccount.automountServiceAccountToken: false
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ServiceAccount
      - equal:
          path: automountServiceAccountToken
          value: false
